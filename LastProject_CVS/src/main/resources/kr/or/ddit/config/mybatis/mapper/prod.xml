<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="prod">

<!-- 카테고리 별 제품 리스트 조회  -->
<select id="getCtgyProdList" parameterType="Map" resultType="prodVo">
	SELECT * 
		FROM
			(SELECT a.*,ROWNUM rn 
				FROM
				(SELECT prod.*
					FROM prod
					ORDER BY prod_name)a
					WHERE ${pr_class}=#{pr_class_id})
		WHERE rn BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}

</select>

<!-- 카테고리 별 제품의 갯수  -->
<select id="getCtgyProdCount" parameterType="Map" resultType="Integer">
	select count(*) 
	from prod
	where ${pr_class} = #{pr_class_id}
	
</select>

<!-- 제품아이디로 제품 조회 -->
<select id = "getProd" parameterType="String" resultType="prodVo">
	SELECT * 
	FROM prod
	WHERE prod_id=#{prod_id}
</select>

<!-- 전체 행사 상품 조회 -->
<select id="getAllEventProd" parameterType="Map" resultType="prodVo">
	SELECT * 
		FROM
			(SELECT a.*,ROWNUM rn 
				FROM
				(SELECT prod.*
					FROM prod
					ORDER BY prod_name)a
					WHERE event_id !='200')
		WHERE rn BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}

</select>
<!-- 카테고리별 행사 상품 조회 -->
<select id="getCgEventProd" parameterType="Map" resultType="prodVo">
	SELECT * 
		FROM
			(SELECT a.*,ROWNUM rn 
				FROM
				(SELECT prod.*
					FROM prod
					ORDER BY prod_name)a
					WHERE event_id !='200'
					AND ${pr_class}=#{pr_class_id})
		WHERE rn BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}

</select>

<!-- 행사종류별  전체상품 조회 -->
<select id="getEventProd" parameterType="Map" resultType="prodVo">
	SELECT * 
		FROM
			(SELECT a.*,ROWNUM rn 
				FROM
				(SELECT prod.*
					FROM prod
					ORDER BY prod_name)a
					WHERE event_id =#{event_id})
		WHERE rn BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}

</select>

<!-- 행사종류 및 카테고리별  상품 조회 -->
<select id="getEventCtgyProd" parameterType="Map" resultType="prodVo">
	SELECT * 
		FROM
			(SELECT a.*,ROWNUM rn 
				FROM
				(SELECT prod.*
					FROM prod
					ORDER BY prod_name)a
					WHERE ${pr_class}=#{pr_class_id} and
						  event_id =#{event_id})
		WHERE rn BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}

</select>

<!-- 전체 상품 조회 -->
<select id="getAllProd" parameterType="Map" resultType="prodVo" >
SELECT * 
		FROM
			(SELECT a.*,ROWNUM rn 
				FROM
				(SELECT prod.*
					FROM prod
					ORDER BY prod_name)a
          )
		WHERE rn BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}
</select>



<!-- parameter: 카테고리 평점평균순으로  -->
<select id="getListProdBestCategory" parameterType="Map" resultType="prodVo">
SELECT * FROM
   (SELECT a.*, ROWNUM rn FROM
        (SELECT TBL0.* FROM
            (SELECT P.PROD_ID         
                ,PROD_NAME
                ,PROD_INTRO
                ,PROD_INFO
                ,PROD_PRICE
                ,PROD_EXNUM
                ,PR_CLASS_LG
                ,PR_CLASS_MD
                ,EVENT_ID
                ,FILE_PATH
                ,FILE_UPNAME
                ,FILE_NAME
                   , (SELECT ROUND(AVG(B.BD_RATING),2) FROM BOARD B WHERE B.PROD_ID = P.PROD_ID) BD_RATING
              FROM  prod P
            ) TBL0
            WHERE TBL0.BD_RATING IS NOT NULL
            ORDER BY TBL0.BD_RATING DESC
          )a
            WHERE PR_CLASS_LG=#{category}
        )
WHERE rn &lt;= #{wantNum}
</select>







</mapper>