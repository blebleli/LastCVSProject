<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="supply">

	<!-- 	아 이 디 : getListSupply
	  		반 환 값 : supplySumProdVo
	  		매개변수 : String(place_id)
	  		설    명 : 입고 목록 전체 출력 
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-11     
	 -->
	<select id="getListSupply" parameterType="map" resultType="supplySumProdVo">
		SELECT rownum rnum,T.*
		FROM
		(
		      SELECT a.supply_bcd, a.supply_date,a.supply_state, sum(b.splylist_sum) splylist_sum, sum(c.prod_price*b.splylist_sum) sum
		      FROM supply a, supply_list b, prod c
		      WHERE a.place_id='3630000-104-2015-00121' 
		      AND c.prod_id = b.prod_id   
		      AND a.supply_state = 12
		      AND a.supply_bcd = b.supply_bcd
		      GROUP BY a.supply_bcd, a.supply_date,a.supply_state
		) T  WHERE rownum BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}
	</select>
	
	<!-- 	아 이 디 : supplyDetail
	  		반 환 값 : supplyListVo
	  		매개변수 : string(supply_bcd)
	  		설    명 : 입고 목록중 하나를 클릭했을때 정보 출력
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-11     
	 -->
	<select id="supplyDetail" parameterType="String" resultType="supplyListVo">
		SELECT * FROM supply_list WHERE supply_bcd = #{supply_bcd}
	</select>
	
	<!-- 	아 이 디 : supplyDetailProdList
	  		반 환 값 : supplyListVo
	  		매개변수 : string(supply_bcd)
	  		설    명 : 입고 목록중 하나를 클릭했을때 그에 대한 정보를 가져온다(supply_list) 
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-11     
	 -->
	<select id="supplyDetailProdList" parameterType="String" resultType="supplyListVo">
		SELECT * FROM supply_list WHERE supply_bcd=#{supply_bcd}  
	</select>
	
	<!-- 	아 이 디 : supplyProdInfo
	  		반 환 값 : SupplyProdVo
	  		매개변수 : string(supply_bcd)
	  		설    명 : 입고 상세 보기 내역에서 필요한 정보(수량,제품이름,제품코드)를 가져오는 쿼리
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-11     
	 -->
	<select id="supplyProdInfo" parameterType="map" resultType="supplyProdVo">
		SELECT rownum rnum,T.*
    	FROM (SELECT a.prod_id,b.splylist_info, a.prod_name, a.prod_price, b.splylist_sum
		FROM prod a, supply_list  b
		WHERE b.supply_bcd=#{supply_bcd}
		AND a.prod_id = b.prod_id) T WHERE rownum BETWEEN (#{page}-1)*#{pageSize}+1 AND #{page}*#{pageSize}
	</select>
	
	<!-- 	아 이 디 : insertSupply
	  		반 환 값 : int
	  		매개변수 : supplyVo
	  		설    명 : 발주(10) 결제(11) 입고(12) insert
	  		작 성 자 : 김현경
	  		일    시 : 2018-09-11     
	 -->
	<insert id="insertSupply" parameterType="supplyVo">
	INSERT INTO supply(SUPPLY_BCD, 
					   SUPPLY_STATE, 
					   supply_date, 
					   place_id) 
				VALUES(#{supply_bcd},
					   #{supply_state}, 
					   sysdate, 
					   #{place_id})
	</insert>
	
	<!-- 	아 이 디 : sumProdPrice
	  		반 환 값 : Integer
	  		매개변수 : string(supply_bcd)
	  		설    명 : 클릭한 입고 상세내역에서 제품들의 가격들의 총합을 구하는 쿼리문
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-12     
	 -->
	<select id="sumProdPrice" parameterType="String" resultType="Integer">
		SELECT sum(a.prod_price* b.splylist_sum)
		FROM prod a, supply_list b
		WHERE b.supply_bcd=#{supply_bcd}
		AND a.prod_id = b.prod_id
	</select>
	
	
	<!-- 	아 이 디 : supplyMemberInfo
	  		반 환 값 : memberVo
	  		매개변수 : string(supply_bcd)
	  		설    명 : 입고 상세 내역에서 입고 편의점 점주의 정보를 가져오는 쿼리문
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-12     
	 -->
	<select id="supplyMemberInfo" parameterType="String" resultType="memberVo">
		SELECT a.mem_cvs_name, a.mem_name, a.mem_cvs_tel, a.mem_kind, a.mem_addr 
		FROM member a, supply b
		WHERE b.supply_bcd=#{supply_bcd}
		and a.mem_kind = 01
		AND a.mem_id = b.place_id
	</select>
	
		<!-- 	아 이 디 : supplyListTotCnt
	  		반 환 값 : Integer
	  		매개변수 : 
	  		설    명 : 특정 편의점의 입고 리스트 전체 카운트
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-13     
	 -->
	<select id="supplyListTotCnt" resultType="Integer" >
		SELECT count(*) FROM supply WHERE place_id='3630000-104-2015-00121'
	</select>
	
			<!-- 	아 이 디 : supplyProdTotCnt
	  		반 환 값 : Integer
	  		매개변수 : String(supply_bcd)
	  		설    명 : 특정 입고 상세내역에서 제품들 전체 카운트
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-13     
	 -->
	<select id="supplyProdTotCnt" parameterType="String" resultType="Integer">
		SELECT count(*) 
		FROM prod a, supply_list b
		WHERE b.supply_bcd=#{supply_bcd}
		and b.prod_id = a.prod_id
	</select>
	
	<!-- 	아 이 디 : insertSupplyList
	  		반 환 값 : int
	  		매개변수 : supplyListVo
	  		설    명 :  수불 SupplyList insert
	  		작 성 자 : 김현경
	  		일    시 : 2018-09-11     
	 -->
	<insert id="insertSupplyList" parameterType="supplyListVo">
		INSERT INTO supply_list(splylist_id,
								splylist_info,
								splylist_exdate,
                        		splylist_sum, 
                        		supply_bcd, 
                        		prod_id)
                		VALUES(#{splylist_id},
                			   #{splylist_info},
                			   #{splylist_exdate},
                			   #{splylist_sum},
                			   #{supply_bcd},
                			   #{prod_id})
	</insert>
	
	<!-- 	아 이 디 : supplyScanInfo
	  		반 환 값 : supplyProdVo
	  		매개변수 : String(supply_bcd)
	  		설    명 : 입고 바코드나 직접 입력했을 시 출력할 입고 정보 리스트
	  		작 성 자 : 조계환
	  		일    시 : 2018-09-14     
	-->
	<select id="supplyScanInfo" parameterType="String" resultType="supplyScanInfoVo">
		SELECT rownum rnum,T.*
		FROM (SELECT a.prod_id, b.SPLYLIST_INFO, a.prod_name, a.prod_price, b.splylist_sum, c.supply_state
		FROM prod a, supply_list b, supply c
		WHERE b.supply_bcd=#{supply_bcd}
		AND b.SUPPLY_BCD = c.SUPPLY_BCD
		AND a.prod_id = b.prod_id) T
	</select>
	
	
</mapper>